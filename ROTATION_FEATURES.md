# 八人转完整功能说明

## 已实现功能

### 1. 赛制管理 ✅

#### 支持人数范围
- ✅ 4-13 人参与
- ✅ 特殊处理：6人转、7人转（多种模式选择）
- ✅ 完美排档：8人转、9人转

#### 场次计算
- ✅ 公式实现：N = A × (A-1) / 4
- ✅ 自动计算总比赛场数
- ✅ 6人和7人的特殊场次选项

#### 对阵安排
- ✅ 随机对阵功能
- ✅ 确保每人与各搭档1次（或尽可能平均）
- ✅ 公平性校验

### 2. 比赛流程与计分 ✅

#### 局比分录入
- ✅ 支持录入局比分（2:0, 1:0, 2:1）
- ✅ 积分自动计算：
  - 2:0 或 1:0 → 积 2 分
  - 2:1 → 积 1 分
  - 败北 → 积 0 分

#### 实时排名
- ✅ 根据比赛结果实时生成个人成绩排名
- ✅ 排名规则：
  1. 积分高者得冠
  2. 积分相同，净胜局（小分）高者得冠

#### 让分设置
- ✅ 支持让分配置
- ✅ 预设规则：
  - 女选手优势（获胜额外1分）
  - 男选手让分（需多赢1球）
  - 等级让分（根据等级差异）
- ✅ 自定义让分规则

### 3. 用户与界面 ✅

#### 管理员/组织者
- ✅ 创建、修改、删除比赛
- ✅ 配置赛制（人数、模式、让分）
- ✅ 录入比分
- ✅ 生成排名
- ✅ 权限验证中间件

#### 用户/选手
- ✅ 查看比赛介绍
- ✅ 查看报名名单
- ✅ 实时查看对阵表
- ✅ 实时查看排名结果

#### 报名流程
- ✅ 选手报名功能
- ✅ 人数限制（4-13人）
- ✅ 超额报名处理（可选）

## 特殊处理

### 6人转模式

**标准模式**（默认）
- 每人4场，共6场
- 适合快速比赛

**完整模式**
- 每人6场，共9场
- 更多比赛机会

**超完整模式**
- 每人10场，共15场
- 最完整的比赛体验

### 7人转模式

**标准模式**（默认）
- 每人8场，共14场
- 平衡的比赛量

**完整模式**
- 每人12场，共21场
- 最完整的比赛体验

## API 接口

### 排表生成
```
POST /api/rotation/generate
Body: {
  eventId,
  sixPlayerMode: 'standard' | 'full' | 'super',  // 6人转模式
  sevenPlayerMode: 'standard' | 'full',         // 7人转模式
  randomize: true                                // 是否随机
}
```

### 局比分录入
```
PUT /api/matches/:id/score
Body: {
  gameScoreA: '2:0' 或 {gamesWon: 2, gamesLost: 0},
  gameScoreB: '1:0' 或 {gamesWon: 1, gamesLost: 0}
}
```

### 让分设置
```
PUT /api/handicap/event/:eventId
Body: {
  enabled: true,
  rules: {
    type: 'female_advantage',
    points: 1
  }
}
```

## 数据模型

### Match（比赛）
```javascript
{
  teamA: {
    gameScore: {
      gamesWon: 2,
      gamesLost: 0
    },
    points: 2  // 积分
  },
  teamB: {
    gameScore: {
      gamesWon: 0,
      gamesLost: 2
    },
    points: 0
  }
}
```

### Event（赛事）
```javascript
{
  rotationConfig: {
    specialMode: 'standard',  // 6人或7人的特殊模式
    enableHandicap: true,
    handicapRules: {
      type: 'female_advantage',
      points: 1
    }
  }
}
```

## 排名计算

### 八人转排名规则
1. **第一优先级**：总积分（totalPoints）
2. **第二优先级**：净胜局数（netGames = gamesWon - gamesLost）
3. **第三优先级**：总获胜局数（gamesWon）

### 传统排名规则
1. **第一优先级**：胜场数（wins）
2. **第二优先级**：净胜分（netScore）
3. **第三优先级**：总得分（totalScore）

## 使用示例

### 创建6人转比赛
1. 选择"八人转"玩法
2. 设置最大人数为 6
3. 选择6人转模式（标准/完整/超完整）
4. 配置让分规则（可选）
5. 发布比赛

### 录入局比分
1. 进入计分板
2. 选择比赛
3. 选择队伍A的局比分（如 2:0）
4. 选择队伍B的局比分（如 0:2）
5. 系统自动计算积分
6. 完成比赛

### 查看排名
1. 进入排名页面
2. 查看个人积分排名
3. 查看净胜局数
4. 查看详细统计

## 注意事项

1. **局比分格式**：必须是 "2:0", "1:0", "2:1" 等有效格式
2. **必须有一方获胜**：局比分不能相同
3. **积分计算**：系统自动根据局比分计算积分
4. **排名更新**：每次完成比赛后自动更新排名
5. **让分应用**：让分规则在计算积分时自动应用

