# 八人转功能使用指南

## 功能概述

八人转是一种灵活的双打轮转玩法，核心特点是"固定轮转搭档"，系统会自动排表，确保每个人都会和其他参与者搭档一次。

## 核心特性

### 1. 人数范围
- **支持 4-13 人参与**（不限于8人）
- 系统会根据实际人数自动计算轮数和比赛数

### 2. 排表算法
- **自动配对**：系统自动生成排表
- **固定轮转**：每个人都会和其他参与者搭档一次
- **公平分配**：确保每个人参与的比赛数量尽可能均衡

### 3. 计分方式
- **双打比赛**：每场比赛是双打
- **个人成绩**：记录的是个人胜场数、净胜分
- **个人排名**：按个人总积分排名

## 使用流程

### 1. 选择玩法
- 打开小程序，点击"发起"Tab
- 在"双打"分类下找到"八人转"
- 点击"发起"按钮

### 2. 配置比赛
- **基础信息**：填写比赛标题、时间、地点
- **人数设置**：设置最大人数（4-13人）
- **费用设置**：设置报名费（含场地费平摊）
- **计分设置**：选择每局分数（11/15/21分）
- **进阶设置**：是否允许替补

### 3. 发布比赛
- 检查配置信息
- 点击"发布活动"
- 等待用户报名

### 4. 生成排表
- 报名人数达到要求后
- 系统自动生成排表
- 可以查看每轮的对阵情况

### 5. 进行比赛
- 按照排表进行比赛
- 实时录入比分
- 系统自动统计个人成绩

### 6. 查看排名
- 比赛结束后查看排名
- 按个人胜场数和净胜分排序

## 排表规则说明

### 偶数人数（如8人）
- 共 7 轮比赛
- 每轮 4 场比赛
- 总计 28 场比赛

### 奇数人数（如5人）
- 共 4 轮比赛
- 每轮有 1 人轮空
- 轮空的人该轮不参与比赛

## API 接口

### 生成排表
```
POST /api/rotation/generate
Body: { eventId }
```

### 获取排表
```
GET /api/rotation/schedule/:eventId
```

### 获取排名
```
GET /api/ranking/event/:eventId
```

## 技术实现

### 排表算法
位置：`server/utils/rotation.js`

核心函数：
- `generateRotationSchedule(participants)` - 生成排表
- `isValidRotationCount(count)` - 验证人数
- `calculateRounds(count)` - 计算轮数

### 排名计算
位置：`server/routes/ranking.js`

排名规则：
1. 先按胜场数排序
2. 胜场相同按净胜分排序
3. 净胜分相同按总得分排序

## 注意事项

1. **人数限制**：必须在 4-13 人之间
2. **报名截止**：报名人数达到上限后不能再报名
3. **替补规则**：如果允许替补，可以在比赛开始后加入
4. **成绩统计**：虽然是双打，但排名是按个人成绩

## 示例场景

### 场景1：8人八人转
- 8人参与
- 7轮比赛
- 每轮4场
- 每个人打7场比赛
- 每个人和其他7人都搭档一次

### 场景2：5人八人转
- 5人参与
- 4轮比赛
- 每轮2场比赛（1人轮空）
- 每个人打4场比赛
- 每个人和其他4人都搭档一次



