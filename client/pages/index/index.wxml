<!--pages/index/index.wxml-->
<view class="container">
  <!-- æœç´¢å’Œç­›é€‰æ  -->
  <view class="search-bar">
    <view class="search-box" bindtap="showSearch">
      <text class="search-icon">ğŸ”</text>
      <text class="search-text">æœç´¢èµ›äº‹ã€æ´»åŠ¨ã€ä¿±ä¹éƒ¨</text>
    </view>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <view class="category-tabs">
    <view 
      class="tab-item {{currentCategory === 'all' ? 'active' : ''}}"
      bindtap="switchCategory"
      data-category="all"
    >
      å…¨éƒ¨
    </view>
    <view 
      class="tab-item {{currentCategory === 'competition' ? 'active' : ''}}"
      bindtap="switchCategory"
      data-category="competition"
    >
      æ¯”èµ›
    </view>
    <view 
      class="tab-item {{currentCategory === 'activity' ? 'active' : ''}}"
      bindtap="switchCategory"
      data-category="activity"
    >
      æ´»åŠ¨
    </view>
    <view 
      class="tab-item {{currentCategory === 'club' ? 'active' : ''}}"
      bindtap="switchCategory"
      data-category="club"
    >
      ä¿±ä¹éƒ¨
    </view>
  </view>

  <!-- æ’åºé€‰é¡¹ -->
  <view class="sort-bar">
    <view 
      class="sort-item {{sortBy === 'time' ? 'active' : ''}}"
      bindtap="sortEvents"
      data-sort="time"
    >
      æ—¶é—´
    </view>
    <view 
      class="sort-item {{sortBy === 'distance' ? 'active' : ''}}"
      bindtap="sortEvents"
      data-sort="distance"
    >
      è·ç¦»
    </view>
  </view>

  <!-- èµ›äº‹åˆ—è¡¨ -->
  <view class="event-list">
    <view 
      class="event-card card"
      wx:for="{{filteredEvents}}"
      wx:key="id"
      bindtap="goToEventDetail"
      data-id="{{item.id}}"
    >
      <view class="event-header">
        <view class="event-title">{{item.title}}</view>
        <view class="status-tag {{item.statusClass}}">{{item.status}}</view>
      </view>
      
      <view class="event-info">
        <view class="info-item">
          <text class="info-icon">ğŸ“…</text>
          <text>{{item.startTime}}</text>
        </view>
        <view class="info-item">
          <text class="info-icon">ğŸ“</text>
          <text>{{item.location}}</text>
          <text class="distance" wx:if="{{item.distance}}">{{item.distance}}km</text>
        </view>
        <view class="info-item">
          <text class="info-icon">ğŸ‘¥</text>
          <text>{{item.currentParticipants}}/{{item.maxParticipants}}äºº</text>
          <text class="tag tag-danger" wx:if="{{item.registration.isFull}}" style="margin-left: 10rpx; font-size: 20rpx;">å·²æ»¡</text>
        </view>
        <view class="info-item">
          <text class="info-icon">ğŸ†</text>
          <text>{{item.formatText}} Â· {{item.scoringSystem}}åˆ†åˆ¶</text>
        </view>
        <view class="info-item" wx:if="{{item.organizer}}">
          <text class="info-icon">ğŸ¢</text>
          <text>{{item.organizerName}}</text>
        </view>
      </view>

      <!-- å‚ä¸è€…å¤´åƒ -->
      <view class="participants-preview" wx:if="{{item.participants && item.participants.length > 0}}">
        <view class="participants-avatars">
          <image 
            class="participant-avatar"
            wx:for="{{item.participants}}"
            wx:key="id"
            wx:for-item="participant"
            src="{{participant.avatar}}"
            mode="aspectFill"
          />
        </view>
        <text class="participants-count" wx:if="{{item.participants.length > 5}}">+{{item.participants.length - 5}}</text>
      </view>

      <view class="event-footer">
        <view class="event-tags">
          <text class="tag tag-primary" wx:if="{{item.registrationFee > 0}}">Â¥{{item.registrationFee}}</text>
          <text class="tag tag-info">{{item.rotationRule}}</text>
          <text class="tag tag-default" wx:if="{{item.stats && item.stats.views}}">ğŸ‘ï¸ {{item.stats.views}}</text>
        </view>
        <view class="event-type">{{item.categoryText}}</view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="empty-state" wx:if="{{loading}}">
    <view class="empty-state-icon">â³</view>
    <view class="empty-state-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && error}}">
    <view class="empty-state-icon">âš ï¸</view>
    <view class="empty-state-text">{{error}}</view>
    <button class="btn-primary" bindtap="loadEvents" style="margin-top: 20rpx;">é‡è¯•</button>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && !error && filteredEvents.length === 0}}">
    <view class="empty-state-icon">ğŸ¸</view>
    <view class="empty-state-text">æš‚æ— èµ›äº‹</view>
  </view>
</view>

