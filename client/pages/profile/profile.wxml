<!--pages/profile/profile.wxml-->
<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯ -->
  <view class="user-section card">
    <!-- å·²ç™»å½•çŠ¶æ€ -->
    <view class="user-header" wx:if="{{isLoggedIn && userInfo}}">
      <image 
        class="avatar" 
        src="{{userInfo.avatarUrl || '/images/userDefault.png'}}" 
        mode="aspectFill"
        binderror="onAvatarError"
      ></image>
      <view class="user-details">
        <text class="nickname">{{userInfo.nickName || 'ç”¨æˆ·'}}</text>
        <text class="phone" wx:if="{{hasPhone}}">{{phoneNumber}}</text>
        <text class="phone-placeholder" wx:else>æœªç»‘å®šæ‰‹æœºå·</text>
      </view>
    </view>
    
    <!-- æœªç™»å½•çŠ¶æ€ -->
    <view class="login-prompt" wx:if="{{!isLoggedIn}}">
      <text class="prompt-text">ç™»å½•åå¯ä½¿ç”¨æ›´å¤šåŠŸèƒ½</text>
      <button 
        class="btn-primary login-btn"
        bindtap="handleLogin"
      >
        å¾®ä¿¡æˆæƒç™»å½•
      </button>
    </view>

    <!-- å·²ç™»å½•æ“ä½œ -->
    <view class="user-actions" wx:if="{{isLoggedIn && userInfo}}">
      <!-- ç»‘å®šæ‰‹æœºå· -->
      <button 
        class="btn-phone"
        wx:if="{{!hasPhone}}"
        open-type="getPhoneNumber"
        bindgetphonenumber="getPhoneNumber"
      >
        ğŸ“± ç»‘å®šæ‰‹æœºå·
      </button>
      <!-- é€€å‡ºç™»å½• -->
      <button 
        class="btn-logout"
        bindtap="logout"
      >
        é€€å‡ºç™»å½•
      </button>
    </view>
  </view>

  <!-- ä¸ªäººæˆ˜ç»© -->
  <view class="record-section card" wx:if="{{isLoggedIn && userInfo}}">
    <view class="section-title">ä¸ªäººæˆ˜ç»©</view>
    
    <!-- ä¸»è¦ç»Ÿè®¡ -->
    <view class="record-stats">
      <view class="stat-item">
        <view class="stat-value">{{record.totalMatches}}</view>
        <view class="stat-label">æ€»åœºæ¬¡</view>
      </view>
      <view class="stat-item">
        <view class="stat-value stat-win">{{record.totalWins}}</view>
        <view class="stat-label">èƒœåœº</view>
      </view>
      <view class="stat-item">
        <view class="stat-value stat-loss">{{record.totalLosses}}</view>
        <view class="stat-label">è´Ÿåœº</view>
      </view>
      <view class="stat-item">
        <view class="stat-value stat-rate">{{record.winRate}}%</view>
        <view class="stat-label">èƒœç‡</view>
      </view>
    </view>

    <!-- è¯¦ç»†æ•°æ® -->
    <view class="record-details" wx:if="{{record.totalMatches > 0}}">
      <!-- å…«äººè½¬æ•°æ® -->
      <view class="detail-group" wx:if="{{record.totalPoints > 0}}">
        <view class="detail-title">å…«äººè½¬æ•°æ®</view>
        <view class="detail-row">
          <text class="detail-label">æ€»ç§¯åˆ†ï¼š</text>
          <text class="detail-value">{{record.totalPoints}}åˆ†</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">å‡€èƒœå±€ï¼š</text>
          <text class="detail-value {{record.netGames >= 0 ? 'positive' : 'negative'}}">
            {{record.netGames >= 0 ? '+' : ''}}{{record.netGames}}
          </text>
        </view>
        <view class="detail-row">
          <text class="detail-label">å±€æ¯”åˆ†ï¼š</text>
          <text class="detail-value">{{record.totalGamesWon}}:{{record.totalGamesLost}}</text>
        </view>
      </view>

      <!-- ä¼ ç»Ÿè®¡åˆ†æ•°æ® -->
      <view class="detail-group" wx:if="{{record.totalScore > 0 && record.totalPoints == 0}}">
        <view class="detail-title">ä¼ ç»Ÿè®¡åˆ†æ•°æ®</view>
        <view class="detail-row">
          <text class="detail-label">æ€»å¾—åˆ†ï¼š</text>
          <text class="detail-value">{{record.totalScore}}åˆ†</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">æ€»å¤±åˆ†ï¼š</text>
          <text class="detail-value">{{record.totalAgainstScore}}åˆ†</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">å‡€èƒœåˆ†ï¼š</text>
          <text class="detail-value {{record.netScore >= 0 ? 'positive' : 'negative'}}">
            {{record.netScore >= 0 ? '+' : ''}}{{record.netScore}}
          </text>
        </view>
      </view>

      <!-- æœ€è¿‘æˆ˜ç»© -->
      <view class="detail-group" wx:if="{{record.recentMatches && record.recentMatches.length > 0}}">
        <view class="detail-title">æœ€è¿‘æˆ˜ç»©</view>
        <view class="recent-matches">
          <view 
            class="recent-match-item"
            wx:for="{{record.recentMatches}}"
            wx:key="id"
          >
            <view class="match-result">
              <text class="result-badge {{item.isWinner ? 'win' : 'loss'}}">
                {{item.result}}
              </text>
              <text class="match-event">{{item.eventTitle}}</text>
            </view>
            <text class="match-date">{{item.date}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ— æˆ˜ç»©æç¤º -->
    <view class="no-record" wx:else>
      <text class="no-record-text">æš‚æ— æˆ˜ç»©æ•°æ®</text>
      <text class="no-record-hint">å‚ä¸æ¯”èµ›åå³å¯æŸ¥çœ‹æˆ˜ç»©</text>
    </view>
  </view>

  <!-- æˆ‘çš„æ´»åŠ¨ -->
  <view class="menu-section card">
    <view class="section-title">æˆ‘çš„æ´»åŠ¨</view>
    <view class="menu-item" bindtap="goToMyEvents" data-type="registered">
      <text class="menu-icon">ğŸ“‹</text>
      <text class="menu-text">å·²æŠ¥å</text>
      <text class="menu-badge" wx:if="{{registeredCount > 0}}">{{registeredCount}}</text>
      <text class="menu-arrow">></text>
    </view>
    <view class="menu-item" bindtap="goToMyEvents" data-type="created">
      <text class="menu-icon">â•</text>
      <text class="menu-text">æˆ‘å‘å¸ƒçš„</text>
      <text class="menu-badge" wx:if="{{createdCount > 0}}">{{createdCount}}</text>
      <text class="menu-arrow">></text>
    </view>
    <view class="menu-item" bindtap="goToMyEvents" data-type="history">
      <text class="menu-icon">ğŸ“Š</text>
      <text class="menu-text">å†å²è®°å½•</text>
      <text class="menu-arrow">></text>
    </view>
  </view>

  <!-- å…¶ä»–åŠŸèƒ½ -->
  <view class="menu-section card">
    <view class="section-title">å…¶ä»–åŠŸèƒ½</view>
    <view class="menu-item" bindtap="showAbout">
      <text class="menu-icon">â„¹ï¸</text>
      <text class="menu-text">å…³äºæˆ‘ä»¬</text>
      <text class="menu-arrow">></text>
    </view>
    <view class="menu-item" bindtap="showFeedback">
      <text class="menu-icon">ğŸ’¬</text>
      <text class="menu-text">æ„è§åé¦ˆ</text>
      <text class="menu-arrow">></text>
    </view>
  </view>
</view>

